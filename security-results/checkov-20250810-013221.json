{"check_type": "terraform", "results": {"passed_checks": [{"check_id": "CKV_K8S_41", "bc_check_id": "BC_K8S_38", "check_name": "Ensure that default service accounts are not actively used", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[11, "resource \"kubernetes_service_account\" \"this\" {\n"], [12, "  metadata {\n"], [13, "    name      = local.rbac_config.service_account_name\n"], [14, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [15, "    labels    = local.common_labels\n"], [16, "  }\n"], [17, "\n"], [18, "  depends_on = [kubernetes_namespace.this]\n"], [19, "}\n"]], "file_path": "/helm-promtail/main.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "repo_file_path": "/helm-promtail/main.tf", "file_line_range": [11, 19], "resource": "module.promtail.kubernetes_service_account.this", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DefaultServiceAccount", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [422, 452], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-38", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "promtail", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 945, "source_module_object": null}]}}, {"check_id": "CKV_K8S_49", "bc_check_id": "BC_K8S_107", "check_name": "Minimize wildcard use in Roles and ClusterRoles", "check_result": {"result": "PASSED", "evaluated_keys": ["rule"]}, "code_block": [[22, "resource \"kubernetes_cluster_role\" \"this\" {\n"], [23, "  metadata {\n"], [24, "    name   = local.rbac_config.cluster_role_name\n"], [25, "    labels = local.common_labels\n"], [26, "  }\n"], [27, "\n"], [28, "  rule {\n"], [29, "    api_groups = [\"\"]\n"], [30, "    resources  = [\"nodes\", \"nodes/proxy\", \"services\", \"endpoints\", \"pods\", \"pods/log\"]\n"], [31, "    verbs      = [\"get\", \"watch\", \"list\"]\n"], [32, "  }\n"], [33, "\n"], [34, "  rule {\n"], [35, "    api_groups = [\"apps\"]\n"], [36, "    resources  = [\"daemonsets\", \"deployments\", \"replicasets\"]\n"], [37, "    verbs      = [\"get\", \"watch\", \"list\"]\n"], [38, "  }\n"], [39, "\n"], [40, "  rule {\n"], [41, "    api_groups = [\"extensions\", \"networking.k8s.io\"]\n"], [42, "    resources  = [\"ingresses\"]\n"], [43, "    verbs      = [\"get\", \"watch\", \"list\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  rule {\n"], [47, "    api_groups = [\"\"]\n"], [48, "    resources  = [\"namespaces\"]\n"], [49, "    verbs      = [\"get\", \"watch\", \"list\"]\n"], [50, "  }\n"], [51, "\n"], [52, "  rule {\n"], [53, "    non_resource_urls = [\"/metrics\"]\n"], [54, "    verbs             = [\"get\"]\n"], [55, "  }\n"], [56, "}\n"]], "file_path": "/helm-promtail/main.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "repo_file_path": "/helm-promtail/main.tf", "file_line_range": [22, 56], "resource": "module.promtail.kubernetes_cluster_role.this", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.WildcardRoles", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [422, 452], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/ensure-minimized-wildcard-use-in-roles-and-clusterroles", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "promtail", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 945, "source_module_object": null}]}}, {"check_id": "CKV_K8S_42", "bc_check_id": "BC_K8S_45", "check_name": "Ensure that default service accounts are not actively used", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[59, "resource \"kubernetes_cluster_role_binding\" \"this\" {\n"], [60, "  metadata {\n"], [61, "    name   = local.rbac_config.cluster_role_binding_name\n"], [62, "    labels = local.common_labels\n"], [63, "  }\n"], [64, "\n"], [65, "  role_ref {\n"], [66, "    api_group = \"rbac.authorization.k8s.io\"\n"], [67, "    kind      = \"ClusterRole\"\n"], [68, "    name      = kubernetes_cluster_role.this.metadata[0].name\n"], [69, "  }\n"], [70, "\n"], [71, "  subject {\n"], [72, "    kind      = \"ServiceAccount\"\n"], [73, "    name      = kubernetes_service_account.this.metadata[0].name\n"], [74, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [75, "  }\n"], [76, "}\n"]], "file_path": "/helm-promtail/main.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "repo_file_path": "/helm-promtail/main.tf", "file_line_range": [59, 76], "resource": "module.promtail.kubernetes_cluster_role_binding.this", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DefaultServiceAccountBinding", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [422, 452], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/ensure-default-service-accounts-are-not-actively-used", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-promtail/main.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "promtail", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 945, "source_module_object": null}]}}, {"check_id": "CKV_K8S_49", "bc_check_id": "BC_K8S_107", "check_name": "Minimize wildcard use in Roles and ClusterRoles", "check_result": {"result": "PASSED", "evaluated_keys": ["rule"]}, "code_block": [[11, "resource \"kubernetes_role\" \"vault\" {\n"], [12, "  metadata {\n"], [13, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [14, "    name      = \"vault-unsealer\"\n"], [15, "  }\n"], [16, "\n"], [17, "  rule {\n"], [18, "    api_groups = [\"\"]\n"], [19, "    resources  = [\"secrets\"]\n"], [20, "    verbs      = [\"create\", \"get\", \"list\", \"patch\", \"update\"]\n"], [21, "  }\n"], [22, "}\n"]], "file_path": "/helm-vault/rbac.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/rbac.tf", "repo_file_path": "/helm-vault/rbac.tf", "file_line_range": [11, 22], "resource": "module.vault.kubernetes_role.vault", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.WildcardRoles", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/ensure-minimized-wildcard-use-in-roles-and-clusterroles", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/rbac.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_42", "bc_check_id": "BC_K8S_45", "check_name": "Ensure that default service accounts are not actively used", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[25, "resource \"kubernetes_role_binding\" \"vault\" {\n"], [26, "  metadata {\n"], [27, "    name      = \"vault-unsealer\"\n"], [28, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [29, "  }\n"], [30, "  role_ref {\n"], [31, "    api_group = \"rbac.authorization.k8s.io\"\n"], [32, "    kind      = \"Role\"\n"], [33, "    name      = kubernetes_role.vault.metadata[0].name\n"], [34, "  }\n"], [35, "  subject {\n"], [36, "    kind      = \"ServiceAccount\"\n"], [37, "    name      = data.kubernetes_service_account.vault.metadata[0].name\n"], [38, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [39, "  }\n"], [40, "}"]], "file_path": "/helm-vault/rbac.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/rbac.tf", "repo_file_path": "/helm-vault/rbac.tf", "file_line_range": [25, 40], "resource": "module.vault.kubernetes_role_binding.vault", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DefaultServiceAccountBinding", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/ensure-default-service-accounts-are-not-actively-used", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/rbac.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_34", "bc_check_id": "BC_K8S_32", "check_name": "Ensure that Tiller (Helm v2) is not deployed", "check_result": {"result": "PASSED", "evaluated_keys": ["spec/[0]/template/[0]/metadata/[0]/labels"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.Tiller", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-32", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_13", "bc_check_id": "BC_K8S_12", "check_name": "Memory requests should be set", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.MemoryRequests", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-12", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_22", "bc_check_id": "BC_K8S_21", "check_name": "Use read-only filesystem for containers where possible", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ReadonlyRootFilesystem", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-21", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_20", "bc_check_id": "BC_K8S_19", "check_name": "Containers should not run with allowPrivilegeEscalation", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.AllowPrivilegeEscalation", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-19", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_26", "bc_check_id": "BC_K8S_25", "check_name": "Do not specify hostPort unless absolutely necessary", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.HostPort", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-25", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_16", "bc_check_id": "BC_K8S_15", "check_name": "Do not admit privileged containers", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.PrivilegedContainer", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-15", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_15", "bc_check_id": "BC_K8S_14", "check_name": "Image Pull Policy should be Always", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ImagePullPolicyAlways", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-14", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_27", "bc_check_id": "BC_K8S_26", "check_name": "Do not expose the docker daemon socket to containers", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DockerSocketVolume", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-26", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_12", "bc_check_id": "BC_K8S_11", "check_name": "Memory Limits should be set", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.MemoryLimits", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-11", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_37", "bc_check_id": "BC_K8S_34", "check_name": "Minimise the admission of containers with capabilities assigned", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.MinimiseCapabilities", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-34", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_10", "bc_check_id": "BC_K8S_9", "check_name": "CPU requests should be set", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.CPURequests", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-9", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_39", "bc_check_id": "BC_K8S_36", "check_name": "Do not use the CAP_SYS_ADMIN linux capability", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.AllowedCapabilitiesSysAdmin", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-36", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_19", "bc_check_id": "BC_K8S_18", "check_name": "Do not admit containers wishing to share the host network namespace", "check_result": {"result": "PASSED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/host_network"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.SharedHostNetworkNamespace", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-18", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_159", "bc_check_id": null, "check_name": "Do not admit privileged containers", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DangerousGitSync", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": {}, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": null, "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_17", "bc_check_id": "BC_K8S_16", "check_name": "Do not admit containers wishing to share the host process ID namespace", "check_result": {"result": "PASSED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/host_pid"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ShareHostPID", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-16", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_18", "bc_check_id": "BC_K8S_17", "check_name": "Do not admit containers wishing to share the host IPC namespace", "check_result": {"result": "PASSED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/host_ipc"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ShareHostIPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-17", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_25", "bc_check_id": "BC_K8S_24", "check_name": "Minimize the admission of containers with added capability", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.AllowedCapabilities", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-24", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_11", "bc_check_id": "BC_K8S_10", "check_name": "CPU Limits should be set", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.CPULimits", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-10", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}], "failed_checks": [{"check_id": "CKV_K8S_28", "bc_check_id": "BC_K8S_27", "check_name": "Minimize the admission of containers with the NET_RAW capability", "check_result": {"result": "FAILED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/container/0"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.DropCapabilities", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-27", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_29", "bc_check_id": "BC_K8S_43", "check_name": "Apply security context to your pods, deployments and daemon_sets", "check_result": {"result": "FAILED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/container/0"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.PodSecurityContext", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/ensure-securitycontext-is-applied-to-pods-and-containers", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_30", "bc_check_id": "BC_K8S_28", "check_name": "Apply security context to your pods and containers", "check_result": {"result": "FAILED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/container/[0]/security_context"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ContainerSecurityContext", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-28", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}, {"check_id": "CKV_K8S_14", "bc_check_id": "BC_K8S_13", "check_name": "Image Tag should be fixed - not latest or blank", "check_result": {"result": "FAILED", "evaluated_keys": ["spec/[0]/template/[0]/spec/[0]/container/[0]/image"]}, "code_block": [[1, "resource \"kubernetes_deployment\" \"vault_unsealer\" {\n"], [2, "  metadata {\n"], [3, "    name      = \"${var.name}-unsealer\"\n"], [4, "    namespace = kubernetes_namespace.this.metadata[0].name\n"], [5, "    labels = {\n"], [6, "      app = \"${var.name}-unsealer\"\n"], [7, "    }\n"], [8, "  }\n"], [9, "\n"], [10, "  spec {\n"], [11, "    replicas = 1\n"], [12, "\n"], [13, "    selector {\n"], [14, "      match_labels = {\n"], [15, "        app = \"${var.name}-unsealer\"\n"], [16, "      }\n"], [17, "    }\n"], [18, "\n"], [19, "    template {\n"], [20, "      metadata {\n"], [21, "        labels = {\n"], [22, "          app = \"${var.name}-unsealer\"\n"], [23, "        }\n"], [24, "      }\n"], [25, "\n"], [26, "      spec {\n"], [27, "        service_account_name = data.kubernetes_service_account.vault.metadata[0].name\n"], [28, "\n"], [29, "        container {\n"], [30, "          name  = \"vault-unsealer\"\n"], [31, "          image = \"curlimages/curl:latest\"\n"], [32, "\n"], [33, "          command = [\"/bin/sh\"]\n"], [34, "          args    = [\"-c\", \"while true; do /scripts/vault-unsealer.sh; sleep 30; done\"]\n"], [35, "\n"], [36, "          env {\n"], [37, "            name  = \"VAULT_SERVICE\"\n"], [38, "            value = var.name\n"], [39, "          }\n"], [40, "\n"], [41, "          env {\n"], [42, "            name  = \"VAULT_NAMESPACE\"\n"], [43, "            value = kubernetes_namespace.this.metadata[0].name\n"], [44, "          }\n"], [45, "\n"], [46, "          volume_mount {\n"], [47, "            name       = \"vault-scripts\"\n"], [48, "            mount_path = \"/scripts\"\n"], [49, "            read_only  = true\n"], [50, "          }\n"], [51, "\n"], [52, "          volume_mount {\n"], [53, "            name       = \"sa-token\"\n"], [54, "            mount_path = \"/var/run/secrets/kubernetes.io/serviceaccount\"\n"], [55, "            read_only  = true\n"], [56, "          }\n"], [57, "\n"], [58, "          resources {\n"], [59, "            requests = {\n"], [60, "              cpu    = \"50m\"\n"], [61, "              memory = \"64Mi\"\n"], [62, "            }\n"], [63, "            limits = {\n"], [64, "              cpu    = \"100m\"\n"], [65, "              memory = \"128Mi\"\n"], [66, "            }\n"], [67, "          }\n"], [68, "        }\n"], [69, "\n"], [70, "        volume {\n"], [71, "          name = \"vault-scripts\"\n"], [72, "          config_map {\n"], [73, "            name         = kubernetes_config_map.vault_scripts.metadata[0].name\n"], [74, "            default_mode = \"0555\"\n"], [75, "          }\n"], [76, "        }\n"], [77, "\n"], [78, "        volume {\n"], [79, "          name = \"sa-token\"\n"], [80, "          projected {\n"], [81, "            sources {\n"], [82, "              service_account_token {\n"], [83, "                path               = \"token\"\n"], [84, "                expiration_seconds = 3607\n"], [85, "              }\n"], [86, "              config_map {\n"], [87, "                name = \"kube-root-ca.crt\"\n"], [88, "                items {\n"], [89, "                  key  = \"ca.crt\"\n"], [90, "                  path = \"ca.crt\"\n"], [91, "                }\n"], [92, "              }\n"], [93, "              downward_api {\n"], [94, "                items {\n"], [95, "                  path = \"namespace\"\n"], [96, "                  field_ref {\n"], [97, "                    field_path = \"metadata.namespace\"\n"], [98, "                  }\n"], [99, "                }\n"], [100, "              }\n"], [101, "            }\n"], [102, "          }\n"], [103, "        }\n"], [104, "\n"], [105, "        restart_policy = \"Always\"\n"], [106, "      }\n"], [107, "    }\n"], [108, "  }\n"], [109, "\n"], [110, "  lifecycle {\n"], [111, "    ignore_changes = [\n"], [112, "      spec[0].template[0].spec[0].volume[1].projected[0].sources\n"], [113, "    ]\n"], [114, "  }\n"], [115, "}"]], "file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_abs_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "repo_file_path": "/helm-vault/vault-unsealer-deployment.tf", "file_line_range": [1, 115], "resource": "module.vault.kubernetes_deployment.vault_unsealer", "evaluations": null, "check_class": "checkov.terraform.checks.resource.kubernetes.ImageTagFixed", "fixed_definition": null, "entity_tags": null, "caller_file_path": "/main.tf", "caller_file_line_range": [488, 523], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/kubernetes-policies/kubernetes-policy-index/bc-k8s-13", "details": [], "check_len": null, "definition_context_file_path": "/Volumes/code/infrastructure/tf-kube-any-compute/helm-vault/vault-unsealer-deployment.tf", "breadcrumbs": {"source_module_": [{"type": "module", "name": "vault", "path": "/Volumes/code/infrastructure/tf-kube-any-compute/main.tf", "idx": 947, "source_module_object": null}]}}], "skipped_checks": [], "parsing_errors": []}, "summary": {"passed": 23, "failed": 4, "skipped": 0, "parsing_errors": 0, "resource_count": 99, "checkov_version": "3.2.450"}, "url": "Add an api key '--bc-api-key <api-key>' to see more detailed insights via https://bridgecrew.cloud"}